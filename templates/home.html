{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block content %}
{% csrf_token %}

{% if user.is_authenticated %}
Hi {{ user.username }}
<p><a href="{% url 'logout' %}">LOG OUT</a></p>
{% else %}
    <p>You are not logged in</p>
    <a href="{% url 'login' %}">LOG IN</a> |
    <a href="{% url 'signup' %}">SIGN UP</a>
{% endif %}

<div id="app">
    <div>
        <input v-model="brand" placeholder="search by brand">
        <button @click="searchSneakersByBrand"><i class="fa fa-search"></i></button>
    </div>
    <h1>[[ message ]]</h1>
    
    <ul>
        <template v-for="sneaker in listOfSneakers">
            <li v-if="sneaker.image.original">
               <button @click="addSneakersToList"><i class="fa-regular fa-heart"></i></button>
        
               <img v-bind:src="sneaker.image.original" alt="" width="400" height="400"> <br>
                name: [[ sneaker.name ]]<br>
                brand: [[ sneaker.brand ]]<br>
                color: [[ sneaker.color ]]<br>
                price: $[[ sneaker.price ]]<br>
                links: [[ sneaker.links ]]<br>
                <button>Buy</button><br>
                <br>
            </li>
        </template>
    </ul>  
</div>


<script src="https://unpkg.com/vue@2"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script> 
    const app = new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data: {
            message: "She'Neaker",
            urlEndpoint: "/api/v1/sneakers/",
            listOfSneakers: '',
            brand: '',
            addSneaker: {
                image: '',
                name: '',
                brand: '',
                color: '',
                price: '',
                links: '',
            },
            idToAdd: 1,
            csrf_token: '',
        },

        methods: {
            getSneakers: function () {
                console.log('loading sneakers')
                axios({
                    method: 'get',
                    url: this.urlEndpoint,
                }).then(response => {
                    console.log(response.data)
                    this.listOfSneakers = response.data
                    console.log('List of Sneakers', this.listOfSneakers)
                }).catch(error => {
                    console.log('error.response: ', error)
                    console.log('error.response.data: ', error.response.data) 
                })

            },
             searchSneakersByBrand: function () {
                axios ({
                    method: 'get',
                    ///api/v1/sneakers/brand/?search=${}
                    url: this.urlEndpoint + `brand/?search=${this.brand}`,
                }).then(response => {
                    console.log(response.data)
                    this.listOfSneakers = response.data
                }).catch(error => {
                    console.log('error.response', error)
                    console.log('error.response.data', error.response.data)
                })
            }, 
            addSneakersToList: function () {
                console.log("adding sneaker to list")
                axios({
                    method: 'get',
                    url: this.urlEndpoint + `${this.idToAdd}/`,
                    data: this.addSneaker,
                }).then(response => {
                    console.log(response.data)
                    this.addSneaker
                }).catch(error => {
                    console.log('error.response', error)
                    console.log('error.response.data', error.response.data)
                })

            },
            
          







        },


        mounted: function () {
            console.log('mounting')
            this.csrf_token = document.querySelector("input[name=csrfmiddlewaretoken]").value
            this.getSneakers()

        }



    });
</script> 

{% endblock %}





